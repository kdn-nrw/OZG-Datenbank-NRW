{#
This file is part of the KDN OZG package.
(c) Gert Hammes <info@gerthammes.de>
For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.
#}

{% extends '@SonataAdmin/standard_layout.html.twig' %}


{% block sonata_page_content %}
    <section class="content">
        {% block notice %}
            {% include '@SonataTwig/FlashMessage/render.html.twig' %}
        {% endblock notice %}
    {# @var apiHandler \App\Api\Consumer\ApiHandler #}
    {% set consumers = apiHandler.consumers %}
    <div id="vsm-snippet-container">
        <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
                {% for consumer in consumers %}
                    {# @var consumer \App\Api\Consumer\ApiConsumerInterface #}
                    {% set isActive = activeConsumerKey == consumer.key or (activeConsumerKey is null and loop.first) %}
                    <li{% if isActive %} class="active"{% endif %}><a href="#api-{{ consumer.key }}" title="{{ consumer.description }}" data-toggle="tab">{{ consumer.name }}</a></li>
                {% endfor %}
            </ul>
            <div class="tab-content">
            {% for consumer in consumers %}
                {# @var consumer \App\Api\Consumer\ApiConsumerInterface #}
                {% set isActive = activeConsumerKey == consumer.key or (activeConsumerKey is null and loop.first) %}
                <div class="{% if isActive %}active {% endif %}tab-pane" id="api-{{ consumer.key }}">
                    <h4>{{ consumer.description }}</h4>
                    {% if forms[consumer.key] is defined %}
                        {% include 'Vsm/Partials/_search-form.html.twig' with {'searchForm': forms[consumer.key], 'consumer': consumer} %}
                    {% endif %}
                    {% if results[consumer.key] is defined %}
                        {% set consumerResults = results[consumer.key] %}
                        {# @var consumerResults \App\Api\Consumer\Model\ResultCollection #}
                        <div class="search-result-container" data-url="{{ consumer.queryUrl }}">
                            {% if consumerResults|length > 0 %}
                                <h3 class="search-result-title">
                                    {{ 'app.api.common.search_results'|trans({'count': consumerResults.totalResultCount}) }}
                                </h3>
                                {% include 'Vsm/Partials/_search-result-nav.html.twig' with {'results': consumerResults, 'consumer': consumer} %}
                                {% include consumer.resultTemplate with {'results': consumerResults, 'consumer': consumer} %}
                                {% if consumerResults.paginationEnabled %}
                                    {% include 'Vsm/Partials/_search-result-pagination.html.twig' with {'results': consumerResults, 'consumer': consumer} %}
                                {% endif %}
                            {% else %}
                                <div class="alert alert-warning">
                                    {{ 'app.api.common.no_result_found'|trans }}
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
            </div>
        </div>
    </div>
    </section>
{% endblock %}