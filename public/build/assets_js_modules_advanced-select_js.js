(self["webpackChunkkdn_ozg"] = self["webpackChunkkdn_ozg"] || []).push([["assets_js_modules_advanced-select_js"],{

/***/ "./assets/js/modules/advanced-select.js":
/*!**********************************************!*\
  !*** ./assets/js/modules/advanced-select.js ***!
  \**********************************************/
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;/**
 * This file is part of the KDN OZG package.
 *
 * @author    Gert Hammes <info@gerthammes.de>
 * @copyright 2020 Gert Hammes
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
(function (root, factory) {
  if (true) {
    !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
		__WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
  } else {}
})(this, function () {
  "use strict";
  /**
   * Initialize custom select2 elements:
   * jQuery and Select2 are loaded globally by Sonata Admin and therefore are not required here!
   */

  return {
    setUpList: function (advancedSelectElements) {
      let self = this;

      for (let i = 0, n = advancedSelectElements.length; i < n; i++) {
        self.initSelect2(advancedSelectElements.item(i));
      }
    },
    initSelect2: function (container) {
      let self = this; // @see vendor/sonata-project/admin-bundle/src/Resources/public/Admin.js

      let select = jQuery(container);
      let allowClearEnabled = false;
      let popover = select.data('popover');
      let maximumSelectionSize = null;
      let minimumResultsForSearch = 10;
      select.removeClass('form-control');

      if (select.find('option[value=""]').length || select.attr('data-sonata-select2-allow-clear') === 'true') {
        allowClearEnabled = true;
      } else if (select.attr('data-sonata-select2-allow-clear') === 'false') {
        allowClearEnabled = false;
      }

      if (select.attr('data-sonata-select2-maximumSelectionSize')) {
        maximumSelectionSize = select.attr('data-sonata-select2-maximumSelectionSize');
      }

      if (select.attr('data-sonata-select2-minimumResultsForSearch')) {
        minimumResultsForSearch = select.attr('data-sonata-select2-minimumResultsForSearch');
      }

      let selectOptions = {
        width: function () {
          // Select2 v3 and v4 BC. If window.Select2 is defined, then the v3 is installed.
          // NEXT_MAJOR: Remove Select2 v3 support.
          return self.getSelect2Width(window.Select2 ? this.element : select);
        },
        dropdownAutoWidth: true,
        minimumResultsForSearch: minimumResultsForSearch,
        allowClear: allowClearEnabled,
        maximumSelectionSize: maximumSelectionSize
      };
      select.select2(selectOptions);

      if (undefined !== popover) {
        select.select2('container').popover(popover.options);
      }

      if (select.attr('data-reload-selector')) {
        select.on('change', function (e) {
          const $reloadSelect = $(select.attr('data-reload-selector')).first();
          self.updateSelectChoices($reloadSelect, e);
        });
      }
    },
    updateSelectChoices: function ($element, event) {
      let self = this;
      let type, changedId;

      if (event.added) {
        type = 'added';
        changedId = event.added.id;
      } else {
        type = 'removed';
        changedId = event.removed.id;
      }

      const postData = {
        changeData: {
          entityId: $element.attr('data-entity-id'),
          groupValues: event.val,
          type: type,
          groupId: changedId
        }
      };
      let xhttp = new XMLHttpRequest();

      xhttp.onreadystatechange = function () {
        if (this.readyState === 4 && this.status === 200) {
          const result = JSON.parse(this.responseText);
          $element.select2('destroy');
          let oldSelected = $element.val();
          let origSelect = $element.get(0);

          for (let i = origSelect.options.length - 1; i >= 0; i--) {
            origSelect.options[i] = null;
          }

          for (let i = 0, n = result.data.serviceList.length; i < n; i++) {
            let opt = document.createElement('option');
            const object = result.data.serviceList[i];
            opt.value = object.id;
            opt.innerHTML = object.text;
            origSelect.appendChild(opt);
          }

          if (!oldSelected) {
            oldSelected = [];
          }

          let newSelected = [];

          if (result.data.removed && result.data.removed.length > 0) {
            for (let k = 0, kn = oldSelected.length; k < kn; k++) {
              let choiceId = parseInt(oldSelected[k]);
              let found = false;

              for (let r = 0, rn = result.data.removed.length; r < rn; r++) {
                if (choiceId === result.data.removed[r].id) {
                  found = true;
                  break;
                }
              }

              if (!found) {
                newSelected.push(choiceId);
              }
            }
          } else if (result.data.added && result.data.added.length > 0) {
            newSelected = oldSelected;

            for (let a = 0, an = result.data.added.length; a < an; a++) {
              let addedObject = result.data.added[a];

              if (oldSelected.indexOf(addedObject.id) < 0) {
                newSelected.push(addedObject.id);
              }
            }
          }

          $(origSelect).val(newSelected);
          $(origSelect).select2({
            width: function () {
              // Select2 v3 and v4 BC. If window.Select2 is defined, then the v3 is installed.
              // NEXT_MAJOR: Remove Select2 v3 support.
              return self.getSelect2Width(window.Select2 ? this.element : select);
            },
            dropdownAutoWidth: true,
            minimumResultsForSearch: 10,
            allowClear: true,
            maximumSelectionSize: null
          });
        }
      };

      let url = $element.attr('data-url');

      if (!url) {
        url = $($element.data('select2').select).attr('data-url');
      }

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("Content-Type", "application/json");
      xhttp.send(JSON.stringify(postData));
    },

    /** Return the width for simple and sortable select2 element
     * @see vendor/sonata-project/admin-bundle/src/Resources/public/Admin.js  **/
    getSelect2Width: function (element) {
      let ereg = /width:(auto|(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc)))/i; // this code is an adaptation of select2 code (initContainerWidth function)

      let style = element.attr('style'); //console.log("main style", style);

      if (style !== undefined) {
        let attrs = style.split(';');

        for (let i = 0, l = attrs.length; i < l; i = i + 1) {
          let matches = attrs[i].replace(/\s/g, '').match(ereg);
          if (matches !== null && matches.length >= 1) return matches[1];
        }
      }

      style = element.css('width');

      if (style.indexOf("%") > 0) {
        return style;
      }

      return '100%';
    },
    addLoader: function (container) {
      container.innerHTML = '<div class="chart-loader"><i class="fa fa-cog fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></div>';
    }
  };
});

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXRzX2pzX21vZHVsZXNfYWR2YW5jZWQtc2VsZWN0X2pzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0MsV0FBVUEsSUFBVixFQUFnQkMsT0FBaEIsRUFBeUI7RUFDdEIsSUFBSSxJQUFKLEVBQWdEO0lBQzVDQyxvQ0FBT0QsT0FBRDtBQUFBO0FBQUE7QUFBQTtBQUFBLGtHQUFOO0VBQ0gsQ0FGRCxNQUVPLEVBU047QUFDSixDQWJBLEVBYUMsSUFiRCxFQWFPLFlBQVk7RUFDaEI7RUFDQTtBQUNKO0FBQ0E7QUFDQTs7RUFDSSxPQUFPO0lBQ0hNLFNBQVMsRUFBRSxVQUFVQyxzQkFBVixFQUFrQztNQUN6QyxJQUFJQyxJQUFJLEdBQUcsSUFBWDs7TUFDQSxLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFSLEVBQVdDLENBQUMsR0FBR0gsc0JBQXNCLENBQUNJLE1BQTNDLEVBQW1ERixDQUFDLEdBQUdDLENBQXZELEVBQTBERCxDQUFDLEVBQTNELEVBQStEO1FBQzNERCxJQUFJLENBQUNJLFdBQUwsQ0FBaUJMLHNCQUFzQixDQUFDTSxJQUF2QixDQUE0QkosQ0FBNUIsQ0FBakI7TUFDSDtJQUNKLENBTkU7SUFRSEcsV0FBVyxFQUFFLFVBQVNFLFNBQVQsRUFBb0I7TUFDN0IsSUFBSU4sSUFBSSxHQUFHLElBQVgsQ0FENkIsQ0FFN0I7O01BQ0EsSUFBSU8sTUFBTSxHQUFvQkMsTUFBTSxDQUFDRixTQUFELENBQXBDO01BQ0EsSUFBSUcsaUJBQWlCLEdBQVMsS0FBOUI7TUFDQSxJQUFJQyxPQUFPLEdBQW1CSCxNQUFNLENBQUNJLElBQVAsQ0FBWSxTQUFaLENBQTlCO01BQ0EsSUFBSUMsb0JBQW9CLEdBQU0sSUFBOUI7TUFDQSxJQUFJQyx1QkFBdUIsR0FBRyxFQUE5QjtNQUVBTixNQUFNLENBQUNPLFdBQVAsQ0FBbUIsY0FBbkI7O01BRUEsSUFBSVAsTUFBTSxDQUFDUSxJQUFQLENB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LElBQUksR0FBRyxxRUFBWCxDQUQ4QixDQUc5Qjs7TUFDQSxJQUFJQyxLQUFLLEdBQUdqRSxPQUFPLENBQUNOLElBQVIsQ0FBYSxPQUFiLENBQVosQ0FKOEIsQ0FLOUI7O01BRUEsSUFBSXVFLEtBQUssS0FBSzdELFNBQWQsRUFBeUI7UUFDckIsSUFBSThELEtBQUssR0FBR0QsS0FBSyxDQUFDRSxLQUFOLENBQVksR0FBWixDQUFaOztRQUVBLEtBQUssSUFBSXhGLENBQUMsR0FBRyxDQUFSLEVBQVd5RixDQUFDLEdBQUdGLEtBQUssQ0FBQ3JGLE1BQTFCLEVBQWtDRixDQUFDLEdBQUd5RixDQUF0QyxFQUF5Q3pGLENBQUMsR0FBR0EsQ0FBQyxHQUFHLENBQWpELEVBQW9EO1VBQ2hELElBQUkwRixPQUFPLEdBQUdILEtBQUssQ0FBQ3ZGLENBQUQsQ0FBTCxDQUFTMkYsT0FBVCxDQUFpQixLQUFqQixFQUF3QixFQUF4QixFQUE0QkMsS0FBNUIsQ0FBa0NQLElBQWxDLENBQWQ7VUFDQSxJQUFJSyxPQUFPLEtBQUssSUFBWixJQUFvQkEsT0FBTyxDQUFDeEYsTUFBUixJQUFrQixDQUExQyxFQUNJLE9BQU93RixPQUFPLENBQUMsQ0FBRCxDQUFkO1FBQ1A7TUFDSjs7TUFFREosS0FBSyxHQUFHakUsT0FBTyxDQUFDd0UsR0FBUixDQUFZLE9BQVosQ0FBUjs7TUFDQSxJQUFJUCxLQUFLLENBQUNQLE9BQU4sQ0FBYyxHQUFkLElBQXFCLENBQXpCLEVBQTRCO1FBQ3hCLE9BQU9PLEtBQVA7TUFDSDs7TUFFRCxPQUFPLE1BQVA7SUFDSCxDQXpLRTtJQTBLSFEsU0FBUyxFQUFFLFVBQVN6RixTQUFULEVBQW9CO01BQzNCQSxTQUFTLENBQUMyRCxTQUFWLEdBQXNCLHNIQUF0QjtJQUNIO0VBNUtFLENBQVA7QUE4S0gsQ0FqTUEsQ0FBRCIsInNvdXJjZXMiOlsid2VicGFjazovL2tkbl9vemcvLi9hc3NldHMvanMvbW9kdWxlcy9hZHZhbmNlZC1zZWxlY3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiB0aGUgS0ROIE9aRyBwYWNrYWdlLlxuICpcbiAqIEBhdXRob3IgICAgR2VydCBIYW1tZXMgPGluZm9AZ2VydGhhbW1lcy5kZT5cbiAqIEBjb3B5cmlnaHQgMjAyMCBHZXJ0IEhhbW1lc1xuICpcbiAqIEZvciB0aGUgZnVsbCBjb3B5cmlnaHQgYW5kIGxpY2Vuc2UgaW5mb3JtYXRpb24sIHBsZWFzZSB2aWV3IHRoZSBMSUNFTlNFXG4gKiBmaWxlIHRoYXQgd2FzIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyBzb3VyY2UgY29kZS5cbiAqL1xuKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoZmFjdG9yeSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgICAgICAvLyBOb2RlLiBEb2VzIG5vdCB3b3JrIHdpdGggc3RyaWN0IENvbW1vbkpTLCBidXRcbiAgICAgICAgLy8gb25seSBDb21tb25KUy1saWtlIGVudmlyb25tZW50cyB0aGF0IHN1cHBvcnQgbW9kdWxlLmV4cG9ydHMsXG4gICAgICAgIC8vIGxpa2UgTm9kZS5cbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdylcbiAgICAgICAgLy8gbm9pbnNwZWN0aW9uIEpTVW5kZWZpbmVkUHJvcGVydHlBc3NpZ25tZW50XG4gICAgICAgIHJvb3QuYXBwQWR2YW5jZVNlbGVjdCA9IGZhY3RvcnkoKTtcbiAgICB9XG59KHRoaXMsIGZ1bmN0aW9uICgpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIGN1c3RvbSBzZWxlY3QyIGVsZW1lbnRzOlxuICAgICAqIGpRdWVyeSBhbmQgU2VsZWN0MiBhcmUgbG9hZGVkIGdsb2JhbGx5IGJ5IFNvbmF0YSBBZG1pbiBhbmQgdGhlcmVmb3JlIGFyZSBub3QgcmVxdWlyZWQgaGVyZSFcbiAgICAgKi9cbiAgICByZXR1cm4ge1xuICAgICAgICBzZXRVcExpc3Q6IGZ1bmN0aW9uIChhZHZhbmNlZFNlbGVjdEVsZW1lbnRzKSB7XG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGFkdmFuY2VkU2VsZWN0RWxlbWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5pbml0U2VsZWN0MihhZHZhbmNlZFNlbGVjdEVsZW1lbnRzLml0ZW0oaSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXRTZWxlY3QyOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIC8vIEBzZWUgdmVuZG9yL3NvbmF0YS1wcm9qZWN0L2FkbWluLWJ1bmRsZS9zcmMvUmVzb3VyY2VzL3B1YmxpYy9BZG1pbi5qc1xuICAgICAgICAgICAgbGV0IHNlbGVjdCAgICAgICAgICAgICAgICAgID0galF1ZXJ5KGNvbnRhaW5lcik7XG4gICAgICAgICAgICBsZXQgYWxsb3dDbGVhckVuYWJsZWQgICAgICAgPSBmYWxzZTtcbiAgICAgICAgICAgIGxldCBwb3BvdmVyICAgICAgICAgICAgICAgICA9IHNlbGVjdC5kYXRhKCdwb3BvdmVyJyk7XG4gICAgICAgICAgICBsZXQgbWF4aW11bVNlbGVjdGlvblNpemUgICAgPSBudWxsO1xuICAgICAgICAgICAgbGV0IG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoID0gMTA7XG5cbiAgICAgICAgICAgIHNlbGVjdC5yZW1vdmVDbGFzcygnZm9ybS1jb250cm9sJyk7XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3QuZmluZCgnb3B0aW9uW3ZhbHVlPVwiXCJdJykubGVuZ3RoIHx8IHNlbGVjdC5hdHRyKCdkYXRhLXNvbmF0YS1zZWxlY3QyLWFsbG93LWNsZWFyJyk9PT0ndHJ1ZScpIHtcbiAgICAgICAgICAgICAgICBhbGxvd0NsZWFyRW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdC5hdHRyKCdkYXRhLXNvbmF0YS1zZWxlY3QyLWFsbG93LWNsZWFyJyk9PT0nZmFsc2UnKSB7XG4gICAgICAgICAgICAgICAgYWxsb3dDbGVhckVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbGVjdC5hdHRyKCdkYXRhLXNvbmF0YS1zZWxlY3QyLW1heGltdW1TZWxlY3Rpb25TaXplJykpIHtcbiAgICAgICAgICAgICAgICBtYXhpbXVtU2VsZWN0aW9uU2l6ZSA9IHNlbGVjdC5hdHRyKCdkYXRhLXNvbmF0YS1zZWxlY3QyLW1heGltdW1TZWxlY3Rpb25TaXplJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZWxlY3QuYXR0cignZGF0YS1zb25hdGEtc2VsZWN0Mi1taW5pbXVtUmVzdWx0c0ZvclNlYXJjaCcpKSB7XG4gICAgICAgICAgICAgICAgbWluaW11bVJlc3VsdHNGb3JTZWFyY2ggPSBzZWxlY3QuYXR0cignZGF0YS1zb25hdGEtc2VsZWN0Mi1taW5pbXVtUmVzdWx0c0ZvclNlYXJjaCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgc2VsZWN0T3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICB3aWR0aDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgLy8gU2VsZWN0MiB2MyBhbmQgdjQgQkMuIElmIHdpbmRvdy5TZWxlY3QyIGlzIGRlZmluZWQsIHRoZW4gdGhlIHYzIGlzIGluc3RhbGxlZC5cbiAgICAgICAgICAgICAgICAgICAgLy8gTkVYVF9NQUpPUjogUmVtb3ZlIFNlbGVjdDIgdjMgc3VwcG9ydC5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U2VsZWN0MldpZHRoKHdpbmRvdy5TZWxlY3QyID8gdGhpcy5lbGVtZW50IDogc2VsZWN0KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRyb3Bkb3duQXV0b1dpZHRoOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiBtaW5pbXVtUmVzdWx0c0ZvclNlYXJjaCxcbiAgICAgICAgICAgICAgICBhbGxvd0NsZWFyOiBhbGxvd0NsZWFyRW5hYmxlZCxcbiAgICAgICAgICAgICAgICBtYXhpbXVtU2VsZWN0aW9uU2l6ZTogbWF4aW11bVNlbGVjdGlvblNpemVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzZWxlY3Quc2VsZWN0MihzZWxlY3RPcHRpb25zKTtcblxuICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCAhPT0gcG9wb3Zlcikge1xuICAgICAgICAgICAgICAgIHNlbGVjdFxuICAgICAgICAgICAgICAgICAgICAuc2VsZWN0MignY29udGFpbmVyJylcbiAgICAgICAgICAgICAgICAgICAgLnBvcG92ZXIocG9wb3Zlci5vcHRpb25zKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzZWxlY3QuYXR0cignZGF0YS1yZWxvYWQtc2VsZWN0b3InKSkge1xuICAgICAgICAgICAgICAgIHNlbGVjdC5vbignY2hhbmdlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJHJlbG9hZFNlbGVjdCA9ICQoc2VsZWN0LmF0dHIoJ2RhdGEtcmVsb2FkLXNlbGVjdG9yJykpLmZpcnN0KCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlU2VsZWN0Q2hvaWNlcygkcmVsb2FkU2VsZWN0LCBlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlU2VsZWN0Q2hvaWNlczogZnVuY3Rpb24oJGVsZW1lbnQsIGV2ZW50KSB7XG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICBsZXQgdHlwZSwgY2hhbmdlZElkO1xuICAgICAgICAgICAgaWYgKGV2ZW50LmFkZGVkKSB7XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdhZGRlZCc7XG4gICAgICAgICAgICAgICAgY2hhbmdlZElkID0gZXZlbnQuYWRkZWQuaWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHR5cGUgPSAncmVtb3ZlZCc7XG4gICAgICAgICAgICAgICAgY2hhbmdlZElkID0gZXZlbnQucmVtb3ZlZC5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHBvc3REYXRhID0ge1xuICAgICAgICAgICAgICAgIGNoYW5nZURhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5SWQ6ICRlbGVtZW50LmF0dHIoJ2RhdGEtZW50aXR5LWlkJyksXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwVmFsdWVzOiBldmVudC52YWwsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwSWQ6IGNoYW5nZWRJZCxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbGV0IHhodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICB4aHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSA0ICYmIHRoaXMuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZSh0aGlzLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICRlbGVtZW50LnNlbGVjdDIoJ2Rlc3Ryb3knKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9sZFNlbGVjdGVkID0gJGVsZW1lbnQudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBvcmlnU2VsZWN0ID0gJGVsZW1lbnQuZ2V0KDApO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gb3JpZ1NlbGVjdC5vcHRpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnU2VsZWN0Lm9wdGlvbnNbaV0gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gcmVzdWx0LmRhdGEuc2VydmljZUxpc3QubGVuZ3RoOyBpIDwgbjsgaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdCA9IHJlc3VsdC5kYXRhLnNlcnZpY2VMaXN0W2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0LnZhbHVlID0gb2JqZWN0LmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0LmlubmVySFRNTCA9IG9iamVjdC50ZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ1NlbGVjdC5hcHBlbmRDaGlsZChvcHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghb2xkU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZFNlbGVjdGVkID0gW107XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1NlbGVjdGVkID0gW107XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZGF0YS5yZW1vdmVkICYmIHJlc3VsdC5kYXRhLnJlbW92ZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDAsIGtuID0gb2xkU2VsZWN0ZWQubGVuZ3RoIDsgayA8IGtuOyBrKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2hvaWNlSWQgPSBwYXJzZUludChvbGRTZWxlY3RlZFtrXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgciA9IDAsIHJuID0gcmVzdWx0LmRhdGEucmVtb3ZlZC5sZW5ndGg7IHIgPCBybjsgcisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaG9pY2VJZCA9PT0gcmVzdWx0LmRhdGEucmVtb3ZlZFtyXS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTZWxlY3RlZC5wdXNoKGNob2ljZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LmRhdGEuYWRkZWQgJiYgcmVzdWx0LmRhdGEuYWRkZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2VsZWN0ZWQgPSBvbGRTZWxlY3RlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGEgPSAwLCBhbiA9IHJlc3VsdC5kYXRhLmFkZGVkLmxlbmd0aCA7IGEgPCBhbjsgYSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFkZGVkT2JqZWN0ID0gcmVzdWx0LmRhdGEuYWRkZWRbYV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFNlbGVjdGVkLmluZGV4T2YoYWRkZWRPYmplY3QuaWQpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTZWxlY3RlZC5wdXNoKGFkZGVkT2JqZWN0LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJChvcmlnU2VsZWN0KS52YWwobmV3U2VsZWN0ZWQpO1xuXG4gICAgICAgICAgICAgICAgICAgICQob3JpZ1NlbGVjdCkuc2VsZWN0Mih7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZWxlY3QyIHYzIGFuZCB2NCBCQy4gSWYgd2luZG93LlNlbGVjdDIgaXMgZGVmaW5lZCwgdGhlbiB0aGUgdjMgaXMgaW5zdGFsbGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5FWFRfTUFKT1I6IFJlbW92ZSBTZWxlY3QyIHYzIHN1cHBvcnQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U2VsZWN0MldpZHRoKHdpbmRvdy5TZWxlY3QyID8gdGhpcy5lbGVtZW50IDogc2VsZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wZG93bkF1dG9XaWR0aDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93Q2xlYXI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhpbXVtU2VsZWN0aW9uU2l6ZTogbnVsbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgdXJsID0gJGVsZW1lbnQuYXR0cignZGF0YS11cmwnKTtcbiAgICAgICAgICAgIGlmICghdXJsKSB7XG4gICAgICAgICAgICAgICAgdXJsID0gJCgkZWxlbWVudC5kYXRhKCdzZWxlY3QyJykuc2VsZWN0KS5hdHRyKCdkYXRhLXVybCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeGh0dHAub3BlbihcIlBPU1RcIiwgdXJsLCB0cnVlKTtcbiAgICAgICAgICAgIHhodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICAgICAgICAgICAgeGh0dHAuc2VuZChKU09OLnN0cmluZ2lmeShwb3N0RGF0YSkpO1xuICAgICAgICB9LFxuICAgICAgICAvKiogUmV0dXJuIHRoZSB3aWR0aCBmb3Igc2ltcGxlIGFuZCBzb3J0YWJsZSBzZWxlY3QyIGVsZW1lbnRcbiAgICAgICAgICogQHNlZSB2ZW5kb3Ivc29uYXRhLXByb2plY3QvYWRtaW4tYnVuZGxlL3NyYy9SZXNvdXJjZXMvcHVibGljL0FkbWluLmpzICAqKi9cbiAgICAgICAgZ2V0U2VsZWN0MldpZHRoOiBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgIGxldCBlcmVnID0gL3dpZHRoOihhdXRvfCgoWy0rXT8oWzAtOV0qXFwuKT9bMC05XSspKHB4fGVtfGV4fCV8aW58Y218bW18cHR8cGMpKSkvaTtcblxuICAgICAgICAgICAgLy8gdGhpcyBjb2RlIGlzIGFuIGFkYXB0YXRpb24gb2Ygc2VsZWN0MiBjb2RlIChpbml0Q29udGFpbmVyV2lkdGggZnVuY3Rpb24pXG4gICAgICAgICAgICBsZXQgc3R5bGUgPSBlbGVtZW50LmF0dHIoJ3N0eWxlJyk7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwibWFpbiBzdHlsZVwiLCBzdHlsZSk7XG5cbiAgICAgICAgICAgIGlmIChzdHlsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbGV0IGF0dHJzID0gc3R5bGUuc3BsaXQoJzsnKTtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYXR0cnMubGVuZ3RoOyBpIDwgbDsgaSA9IGkgKyAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBtYXRjaGVzID0gYXR0cnNbaV0ucmVwbGFjZSgvXFxzL2csICcnKS5tYXRjaChlcmVnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMgIT09IG51bGwgJiYgbWF0Y2hlcy5sZW5ndGggPj0gMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3R5bGUgPSBlbGVtZW50LmNzcygnd2lkdGgnKTtcbiAgICAgICAgICAgIGlmIChzdHlsZS5pbmRleE9mKFwiJVwiKSA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3R5bGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAnMTAwJSc7XG4gICAgICAgIH0sXG4gICAgICAgIGFkZExvYWRlcjogZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9XCJjaGFydC1sb2FkZXJcIj48aSBjbGFzcz1cImZhIGZhLWNvZyBmYS1zcGluIGZhLTN4IGZhLWZ3XCI+PC9pPjxzcGFuIGNsYXNzPVwic3Itb25seVwiPkxvYWRpbmcuLi48L3NwYW4+PC9kaXY+JztcbiAgICAgICAgfVxuICAgIH07XG59KSk7XG4iXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJtb2R1bGUiLCJleHBvcnRzIiwiYXBwQWR2YW5jZVNlbGVjdCIsInNldFVwTGlzdCIsImFkdmFuY2VkU2VsZWN0RWxlbWVudHMiLCJzZWxmIiwiaSIsIm4iLCJsZW5ndGgiLCJpbml0U2VsZWN0MiIsIml0ZW0iLCJjb250YWluZXIiLCJzZWxlY3QiLCJqUXVlcnkiLCJhbGxvd0NsZWFyRW5hYmxlZCIsInBvcG92ZXIiLCJkYXRhIiwibWF4aW11bVNlbGVjdGlvblNpemUiLCJtaW5pbXVtUmVzdWx0c0ZvclNlYXJjaCIsInJlbW92ZUNsYXNzIiwiZmluZCIsImF0dHIiLCJzZWxlY3RPcHRpb25zIiwid2lkdGgiLCJnZXRTZWxlY3QyV2lkdGgiLCJ3aW5kb3ciLCJTZWxlY3QyIiwiZWxlbWVudCIsImRyb3Bkb3duQXV0b1dpZHRoIiwiYWxsb3dDbGVhciIsInNlbGVjdDIiLCJ1bmRlZmluZWQiLCJvcHRpb25zIiwib24iLCJlIiwiJHJlbG9hZFNlbGVjdCIsIiQiLCJmaXJzdCIsInVwZGF0ZVNlbGVjdENob2ljZXMiLCIkZWxlbWVudCIsImV2ZW50IiwidHlwZSIsImNoYW5nZWRJZCIsImFkZGVkIiwiaWQiLCJyZW1vdmVkIiwicG9zdERhdGEiLCJjaGFuZ2VEYXRhIiwiZW50aXR5SWQiLCJncm91cFZhbHVlcyIsInZhbCIsImdyb3VwSWQiLCJ4aHR0cCIsIlhNTEh0dHBSZXF1ZXN0Iiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3VsdCIsIkpTT04iLCJwYXJzZSIsInJlc3BvbnNlVGV4dCIsIm9sZFNlbGVjdGVkIiwib3JpZ1NlbGVjdCIsImdldCIsInNlcnZpY2VMaXN0Iiwib3B0IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwib2JqZWN0IiwidmFsdWUiLCJpbm5lckhUTUwiLCJ0ZXh0IiwiYXBwZW5kQ2hpbGQiLCJuZXdTZWxlY3RlZCIsImsiLCJrbiIsImNob2ljZUlkIiwicGFyc2VJbnQiLCJmb3VuZCIsInIiLCJybiIsInB1c2giLCJhIiwiYW4iLCJhZGRlZE9iamVjdCIsImluZGV4T2YiLCJ1cmwiLCJvcGVuIiwic2V0UmVxdWVzdEhlYWRlciIsInNlbmQiLCJzdHJpbmdpZnkiLCJlcmVnIiwic3R5bGUiLCJhdHRycyIsInNwbGl0IiwibCIsIm1hdGNoZXMiLCJyZXBsYWNlIiwibWF0Y2giLCJjc3MiLCJhZGRMb2FkZXIiXSwic291cmNlUm9vdCI6IiJ9