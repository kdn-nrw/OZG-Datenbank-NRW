(self["webpackChunkkdn_ozg"] = self["webpackChunkkdn_ozg"] || []).push([["assets_js_modules_common_js"],{

/***/ "./assets/js/modules/common.js":
/*!*************************************!*\
  !*** ./assets/js/modules/common.js ***!
  \*************************************/
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;/**
 * This file is part of the KDN OZG package.
 *
 * @author    Gert Hammes <info@gerthammes.de>
 * @copyright 2021 Gert Hammes
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
(function (root, factory) {
  if (true) {
    !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
		__WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
  } else {}
})(this, function () {
  "use strict";
  /**
   * Initialize custom select2 elements:
   * jQuery is loaded globally by Sonata Admin and therefore is not required here!
   */

  return {
    init: function () {
      let self = this;
      self.initTabs();
      self.initClickToggle();
      self.initClickLoad();
      self.initContent(document);
    },
    initTabs: function () {
      let self = this; // only enable in frontend

      if (document.getElementById('header-top')) {
        let lastScrollHash = null;

        if (window.location.hash) {
          lastScrollHash = window.location.hash;
          self.scrollTo(window.location.hash);
        }

        window.addEventListener('scroll', function (event) {
          if (window.location.hash && lastScrollHash !== window.location.hash) {
            lastScrollHash = window.location.hash;
            self.scrollTo(window.location.hash);
          }
        });
        const hash = location.hash.replace(/^#/, ''); // ^ means starting, meaning only match the first hash

        if (hash) {
          const $activeTab = $('.nav-tabs a[href="#' + hash + '"]');

          if ($activeTab.length > 0) {
            $activeTab.parents('.nav-tabs').find('.tab-item.js-init-load').removeClass('js-init-load').addClass('js-click-load');

            if ($activeTab.parent().hasClass('js-click-load')) {
              $activeTab.parent().removeClass('js-click-load').addClass('js-init-load');
            }

            $activeTab.tab('show');
          }
        } // Change hash for page-reload


        $('.nav-tabs a').on('shown.bs.tab', function (e) {
          window.location.hash = e.target.hash;
        });
      }
    },
    initContent: function (parentNode) {
      let self = this;
      $(parentNode).find('[data-toggle="popover"]').popover();
      self.initSortableTables(parentNode);
    },
    initSortableTables: function (parentNode) {
      let sortableTableNodes = parentNode.querySelectorAll('[data-sortable="true"]');

      if (sortableTableNodes.length > 0) {
        // https://stackoverflow.com/questions/14267781/sorting-html-table-with-javascript
        const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

        const comparer = (idx, asc) => (a, b) => ((v1, v2) => v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2))(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

        const sortByHeader = function (tableNode, tableColNodes, th) {
          const tbody = tableNode.tBodies[0];
          const newSortAsc = typeof th.asc === "undefined" || !th.asc;
          tableColNodes.forEach(function (resetTh) {
            if (resetTh.classList.contains('sort-by-active')) {
              resetTh.classList.remove('sort-by-active');
              resetTh.classList.remove('sort-asc');
              resetTh.classList.remove('sort-desc');
            }
          });
          th.classList.add('sort-by-active');
          th.classList.add(newSortAsc ? 'sort-asc' : 'sort-desc');
          th.asc = newSortAsc;
          Array.from(tbody.querySelectorAll('tr')).sort(comparer(Array.from(th.parentNode.children).indexOf(th), newSortAsc)).forEach(tr => tbody.appendChild(tr));
        };

        for (let i = 0, n = sortableTableNodes.length; i < n; i++) {
          const tableNode = sortableTableNodes[i];

          if (!tableNode.classList.contains('table-sortable') && tableNode.tBodies.length === 1) {
            tableNode.classList.add('table-sortable');
            const tableColNodes = tableNode.querySelectorAll('th');
            let sortableColumnCount = 0;
            tableColNodes.forEach(function (sortableTh) {
              const thHtml = sortableTh.innerHTML.trim();

              if (thHtml.length > 0) {
                sortableTh.sortable = true;
                ++sortableColumnCount;

                if (!sortableTh.querySelector('.sort-wrap')) {
                  sortableTh.innerHTML = '<span class="sort-wrap">' + thHtml + '</span>';
                }
              } else {
                sortableTh.sortable = false;
              }
            });

            if (sortableColumnCount > 0) {
              tableColNodes.forEach(function (th, index) {
                if (th.sortable) {
                  th.addEventListener('click', () => {
                    sortByHeader(tableNode, tableColNodes, th);
                  });

                  if (index === 0) {
                    sortByHeader(tableNode, tableColNodes, th);
                  }
                }
              });
            }
          }
        }
      }
    },
    initClickLoad: function () {
      let self = this;

      let loadContent = function (sourceNode) {
        let targetNode;

        if (!sourceNode.classList.contains('js-loaded')) {
          sourceNode.classList.add('js-loaded');

          if (sourceNode.dataset.target) {
            targetNode = document.getElementById(sourceNode.dataset.target);
          } else {
            targetNode = sourceNode;
          }

          self.load(sourceNode.dataset.url, 'GET', function (data) {
            targetNode.innerHTML = data.content;
            self.initContent(targetNode);
          });
        }
      };

      let loadNodes = document.querySelectorAll('.js-init-load');

      if (loadNodes.length > 0) {
        if ('IntersectionObserver' in window && 'IntersectionObserverEntry' in window && 'intersectionRatio' in window.IntersectionObserverEntry.prototype) {
          let observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
              if (entry.intersectionRatio > 0) {
                loadContent(entry.target);
                observer.unobserve(entry.target);
              }
            });
          });

          for (let i = 0, n = loadNodes.length; i < n; i++) {
            observer.observe(loadNodes[i]);
          }
        } else {
          for (let i = 0, n = loadNodes.length; i < n; i++) {
            self.loadContent(loadNodes[i]);
            loadContent(loadNodes[i]);
          }
        }
      }

      self.onClick('.js-click-load', loadContent);
    },
    initClickToggle: function () {
      let self = this;
      self.onClick('.js-click-toggle', function (link) {
        let toggleElt = document.getElementById(link.dataset.toggle);

        if (toggleElt) {
          toggleElt.classList.remove('updating');

          if (toggleElt.classList.contains('open')) {
            toggleElt.classList.remove('open');
            toggleElt.style.display = 'none';
            link.classList.remove('active');
          } else {
            let targets = document.querySelectorAll('.js-toggle-target');

            for (let i = 0, n = targets.length; i < n; i++) {
              if (targets[i] !== toggleElt) {
                targets[i].classList.remove('open');
                targets[i].style.display = 'none';
              }
            }

            toggleElt.classList.add('open');
            toggleElt.removeAttribute('style');
            let toggles = document.querySelectorAll('.js-click-toggle');

            for (let i = 0, n = toggles.length; i < n; i++) {
              if (toggles[i] !== link) {
                toggles[i].classList.remove('active');
              }
            }

            link.classList.add('active');
          }
        }
      });
    },
    onClick: function (selector, callback) {
      document.addEventListener('click', function (evt) {
        let link;

        if (evt.target.matches(selector)) {
          link = evt.target;
        } else {
          link = evt.target.closest(selector);
        }

        if (link) {
          evt.preventDefault();
          evt.stopPropagation();
          callback(link);
        }
      }, false);
    },
    load: function (url, method, callback) {
      let xhr = new XMLHttpRequest(); // Setup our listener to process completed requests

      xhr.onreadystatechange = function () {
        // In local files, status is 0 upon success in Mozilla Firefox
        if (xhr.readyState === XMLHttpRequest.DONE) {
          data = null;
          var status = xhr.status;

          if (status === 0 || status >= 200 && status < 400) {
            // The request has been completed successfully
            try {
              var data = JSON.parse(xhr.responseText);
              callback(data);
            } catch (err) {
              console.log(err.message + " in " + xhr.responseText);
            }
          }
        }
      };

      xhr.open(method, url);
      xhr.send();
    },
    scrollTo: function (selector, duration) {
      let self = this;
      let target = selector ? document.querySelector(selector) : null;

      if (target !== null && (typeof target.dataset.scrolling === "undefined" || target.dataset.scrolling !== "1")) {
        target.dataset.scrolling = "1"; // Wait for swiper initialization

        setTimeout(function () {
          let targetY = $(target).offset().top;

          if ($(target).hasClass('tab-pane')) {
            targetY = $(target).parent().parent().offset().top - 10;
          }

          let $offsetParent = $('#header-top');
          let yOffset = $offsetParent.height();

          if (typeof duration === "undefined" || !duration) {
            duration = 200;
          }

          $('html, body').stop().animate({
            'scrollTop': targetY - yOffset
          }, duration, 'swing', function () {
            target.dataset.scrolling = "0";
            let newTargetY = $(target).offset().top;

            if (selector.indexOf('#') === 0) {
              window.location.hash = selector;
            }
          });
        }, 10);
        return true;
      }

      return false;
    }
  };
});

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QXBCUyxFQW9CUCxFQXBCTyxDQUFWO1FBcUJBLE9BQU8sSUFBUDtNQUNIOztNQUNELE9BQU8sS0FBUDtJQUNIO0VBelBFLENBQVA7QUEyUEgsQ0E5UUEsQ0FBRCIsInNvdXJjZXMiOlsid2VicGFjazovL2tkbl9vemcvLi9hc3NldHMvanMvbW9kdWxlcy9jb21tb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiB0aGUgS0ROIE9aRyBwYWNrYWdlLlxuICpcbiAqIEBhdXRob3IgICAgR2VydCBIYW1tZXMgPGluZm9AZ2VydGhhbW1lcy5kZT5cbiAqIEBjb3B5cmlnaHQgMjAyMSBHZXJ0IEhhbW1lc1xuICpcbiAqIEZvciB0aGUgZnVsbCBjb3B5cmlnaHQgYW5kIGxpY2Vuc2UgaW5mb3JtYXRpb24sIHBsZWFzZSB2aWV3IHRoZSBMSUNFTlNFXG4gKiBmaWxlIHRoYXQgd2FzIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyBzb3VyY2UgY29kZS5cbiAqL1xuKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoZmFjdG9yeSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgICAgICAvLyBOb2RlLiBEb2VzIG5vdCB3b3JrIHdpdGggc3RyaWN0IENvbW1vbkpTLCBidXRcbiAgICAgICAgLy8gb25seSBDb21tb25KUy1saWtlIGVudmlyb25tZW50cyB0aGF0IHN1cHBvcnQgbW9kdWxlLmV4cG9ydHMsXG4gICAgICAgIC8vIGxpa2UgTm9kZS5cbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdylcbiAgICAgICAgLy8gbm9pbnNwZWN0aW9uIEpTVW5kZWZpbmVkUHJvcGVydHlBc3NpZ25tZW50XG4gICAgICAgIHJvb3QuYXBwQ29tbW9uID0gZmFjdG9yeSgpO1xuICAgIH1cbn0odGhpcywgZnVuY3Rpb24gKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgY3VzdG9tIHNlbGVjdDIgZWxlbWVudHM6XG4gICAgICogalF1ZXJ5IGlzIGxvYWRlZCBnbG9iYWxseSBieSBTb25hdGEgQWRtaW4gYW5kIHRoZXJlZm9yZSBpcyBub3QgcmVxdWlyZWQgaGVyZSFcbiAgICAgKi9cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICBzZWxmLmluaXRUYWJzKCk7XG4gICAgICAgICAgICBzZWxmLmluaXRDbGlja1RvZ2dsZSgpO1xuICAgICAgICAgICAgc2VsZi5pbml0Q2xpY2tMb2FkKCk7XG4gICAgICAgICAgICBzZWxmLmluaXRDb250ZW50KGRvY3VtZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgaW5pdFRhYnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgLy8gb25seSBlbmFibGUgaW4gZnJvbnRlbmRcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVhZGVyLXRvcCcpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGxhc3RTY3JvbGxIYXNoID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFzdFNjcm9sbEhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaDtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zY3JvbGxUbyh3aW5kb3cubG9jYXRpb24uaGFzaCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2ggJiYgbGFzdFNjcm9sbEhhc2ggIT09IHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0U2Nyb2xsSGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zY3JvbGxUbyh3aW5kb3cubG9jYXRpb24uaGFzaCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNoID0gbG9jYXRpb24uaGFzaC5yZXBsYWNlKC9eIy8sICcnKTsgIC8vIF4gbWVhbnMgc3RhcnRpbmcsIG1lYW5pbmcgb25seSBtYXRjaCB0aGUgZmlyc3QgaGFzaFxuICAgICAgICAgICAgICAgIGlmIChoYXNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRhY3RpdmVUYWIgPSAkKCcubmF2LXRhYnMgYVtocmVmPVwiIycgKyBoYXNoICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJGFjdGl2ZVRhYi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZlVGFiLnBhcmVudHMoJy5uYXYtdGFicycpLmZpbmQoJy50YWItaXRlbS5qcy1pbml0LWxvYWQnKS5yZW1vdmVDbGFzcygnanMtaW5pdC1sb2FkJykuYWRkQ2xhc3MoJ2pzLWNsaWNrLWxvYWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkYWN0aXZlVGFiLnBhcmVudCgpLmhhc0NsYXNzKCdqcy1jbGljay1sb2FkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZlVGFiLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdqcy1jbGljay1sb2FkJykuYWRkQ2xhc3MoJ2pzLWluaXQtbG9hZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGl2ZVRhYi50YWIoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBDaGFuZ2UgaGFzaCBmb3IgcGFnZS1yZWxvYWRcbiAgICAgICAgICAgICAgICAkKCcubmF2LXRhYnMgYScpLm9uKCdzaG93bi5icy50YWInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IGUudGFyZ2V0Lmhhc2g7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW5pdENvbnRlbnQ6IGZ1bmN0aW9uIChwYXJlbnROb2RlKSB7XG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICAkKHBhcmVudE5vZGUpLmZpbmQoJ1tkYXRhLXRvZ2dsZT1cInBvcG92ZXJcIl0nKS5wb3BvdmVyKCk7XG4gICAgICAgICAgICBzZWxmLmluaXRTb3J0YWJsZVRhYmxlcyhwYXJlbnROb2RlKTtcbiAgICAgICAgfSxcbiAgICAgICAgaW5pdFNvcnRhYmxlVGFibGVzOiBmdW5jdGlvbihwYXJlbnROb2RlKSB7XG4gICAgICAgICAgICBsZXQgc29ydGFibGVUYWJsZU5vZGVzID0gcGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1zb3J0YWJsZT1cInRydWVcIl0nKTtcbiAgICAgICAgICAgIGlmIChzb3J0YWJsZVRhYmxlTm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE0MjY3NzgxL3NvcnRpbmctaHRtbC10YWJsZS13aXRoLWphdmFzY3JpcHRcbiAgICAgICAgICAgICAgICBjb25zdCBnZXRDZWxsVmFsdWUgPSAodHIsIGlkeCkgPT4gdHIuY2hpbGRyZW5baWR4XS5pbm5lclRleHQgfHwgdHIuY2hpbGRyZW5baWR4XS50ZXh0Q29udGVudDtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBhcmVyID0gKGlkeCwgYXNjKSA9PiAoYSwgYikgPT4gKCh2MSwgdjIpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICB2MSAhPT0gJycgJiYgdjIgIT09ICcnICYmICFpc05hTih2MSkgJiYgIWlzTmFOKHYyKSA/IHYxIC0gdjIgOiB2MS50b1N0cmluZygpLmxvY2FsZUNvbXBhcmUodjIpXG4gICAgICAgICAgICAgICAgKShnZXRDZWxsVmFsdWUoYXNjID8gYSA6IGIsIGlkeCksIGdldENlbGxWYWx1ZShhc2MgPyBiIDogYSwgaWR4KSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzb3J0QnlIZWFkZXIgPSBmdW5jdGlvbih0YWJsZU5vZGUsIHRhYmxlQ29sTm9kZXMsIHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRib2R5ID0gdGFibGVOb2RlLnRCb2RpZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1NvcnRBc2MgPSB0eXBlb2YgdGguYXNjID09PSBcInVuZGVmaW5lZFwiIHx8ICF0aC5hc2M7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlQ29sTm9kZXMuZm9yRWFjaChmdW5jdGlvbihyZXNldFRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzZXRUaC5jbGFzc0xpc3QuY29udGFpbnMoJ3NvcnQtYnktYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldFRoLmNsYXNzTGlzdC5yZW1vdmUoJ3NvcnQtYnktYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRUaC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0LWFzYycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0VGguY2xhc3NMaXN0LnJlbW92ZSgnc29ydC1kZXNjJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aC5jbGFzc0xpc3QuYWRkKCdzb3J0LWJ5LWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICB0aC5jbGFzc0xpc3QuYWRkKChuZXdTb3J0QXNjID8gJ3NvcnQtYXNjJyA6ICdzb3J0LWRlc2MnKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoLmFzYyA9IG5ld1NvcnRBc2M7XG4gICAgICAgICAgICAgICAgICAgIEFycmF5LmZyb20odGJvZHkucXVlcnlTZWxlY3RvckFsbCgndHInKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zb3J0KGNvbXBhcmVyKEFycmF5LmZyb20odGgucGFyZW50Tm9kZS5jaGlsZHJlbikuaW5kZXhPZih0aCksIG5ld1NvcnRBc2MpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2godHIgPT4gdGJvZHkuYXBwZW5kQ2hpbGQodHIpICk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IHNvcnRhYmxlVGFibGVOb2Rlcy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFibGVOb2RlID0gc29ydGFibGVUYWJsZU5vZGVzW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRhYmxlTm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ3RhYmxlLXNvcnRhYmxlJykgJiYgdGFibGVOb2RlLnRCb2RpZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZU5vZGUuY2xhc3NMaXN0LmFkZCgndGFibGUtc29ydGFibGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlQ29sTm9kZXMgPSB0YWJsZU5vZGUucXVlcnlTZWxlY3RvckFsbCgndGgnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzb3J0YWJsZUNvbHVtbkNvdW50ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlQ29sTm9kZXMuZm9yRWFjaChmdW5jdGlvbihzb3J0YWJsZVRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGhIdG1sID0gc29ydGFibGVUaC5pbm5lckhUTUwudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aEh0bWwubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZVRoLnNvcnRhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKytzb3J0YWJsZUNvbHVtbkNvdW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNvcnRhYmxlVGgucXVlcnlTZWxlY3RvcignLnNvcnQtd3JhcCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZVRoLmlubmVySFRNTCA9ICc8c3BhbiBjbGFzcz1cInNvcnQtd3JhcFwiPicgKyB0aEh0bWwgKyAnPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3J0YWJsZVRoLnNvcnRhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc29ydGFibGVDb2x1bW5Db3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUNvbE5vZGVzLmZvckVhY2goZnVuY3Rpb24odGgsIGluZGV4KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoLnNvcnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydEJ5SGVhZGVyKHRhYmxlTm9kZSwgdGFibGVDb2xOb2RlcywgdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydEJ5SGVhZGVyKHRhYmxlTm9kZSwgdGFibGVDb2xOb2RlcywgdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGluaXRDbGlja0xvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGxldCBsb2FkQ29udGVudCA9IGZ1bmN0aW9uKHNvdXJjZU5vZGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0Tm9kZTtcbiAgICAgICAgICAgICAgICBpZiAoIXNvdXJjZU5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1sb2FkZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VOb2RlLmNsYXNzTGlzdC5hZGQoJ2pzLWxvYWRlZCcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlTm9kZS5kYXRhc2V0LnRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Tm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNvdXJjZU5vZGUuZGF0YXNldC50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Tm9kZSA9IHNvdXJjZU5vZGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2FkKHNvdXJjZU5vZGUuZGF0YXNldC51cmwsICdHRVQnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXROb2RlLmlubmVySFRNTCA9IGRhdGEuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaW5pdENvbnRlbnQodGFyZ2V0Tm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBsZXQgbG9hZE5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmpzLWluaXQtbG9hZCcpO1xuICAgICAgICAgICAgaWYgKGxvYWROb2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKCdJbnRlcnNlY3Rpb25PYnNlcnZlcicgaW4gd2luZG93ICYmXG4gICAgICAgICAgICAgICAgICAgICdJbnRlcnNlY3Rpb25PYnNlcnZlckVudHJ5JyBpbiB3aW5kb3cgJiZcbiAgICAgICAgICAgICAgICAgICAgJ2ludGVyc2VjdGlvblJhdGlvJyBpbiB3aW5kb3cuSW50ZXJzZWN0aW9uT2JzZXJ2ZXJFbnRyeS5wcm90b3R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKGVudHJpZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkuaW50ZXJzZWN0aW9uUmF0aW8gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRDb250ZW50KGVudHJ5LnRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLnVub2JzZXJ2ZShlbnRyeS50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbiA9IGxvYWROb2Rlcy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUobG9hZE5vZGVzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gbG9hZE5vZGVzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2FkQ29udGVudChsb2FkTm9kZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZENvbnRlbnQobG9hZE5vZGVzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYub25DbGljaygnLmpzLWNsaWNrLWxvYWQnLCBsb2FkQ29udGVudCk7XG4gICAgICAgIH0sXG4gICAgICAgIGluaXRDbGlja1RvZ2dsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgc2VsZi5vbkNsaWNrKCcuanMtY2xpY2stdG9nZ2xlJywgZnVuY3Rpb24obGluaykge1xuICAgICAgICAgICAgICAgIGxldCB0b2dnbGVFbHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaW5rLmRhdGFzZXQudG9nZ2xlKTtcbiAgICAgICAgICAgICAgICBpZiAodG9nZ2xlRWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZUVsdC5jbGFzc0xpc3QucmVtb3ZlKCd1cGRhdGluZycpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodG9nZ2xlRWx0LmNsYXNzTGlzdC5jb250YWlucygnb3BlbicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVFbHQuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRWx0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRhcmdldHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuanMtdG9nZ2xlLXRhcmdldCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSB0YXJnZXRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRzW2ldICE9PSB0b2dnbGVFbHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0c1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldHNbaV0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVFbHQuY2xhc3NMaXN0LmFkZCgnb3BlbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRWx0LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0b2dnbGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmpzLWNsaWNrLXRvZ2dsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSB0b2dnbGVzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2dnbGVzW2ldICE9PSBsaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZXNbaV0uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbGluay5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoc2VsZWN0b3IsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgICAgICAgICAgICBsZXQgbGluaztcbiAgICAgICAgICAgICAgICBpZiAoZXZ0LnRhcmdldC5tYXRjaGVzKHNlbGVjdG9yKSkge1xuICAgICAgICAgICAgICAgICAgICBsaW5rID0gZXZ0LnRhcmdldDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsaW5rID0gZXZ0LnRhcmdldC5jbG9zZXN0KHNlbGVjdG9yKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobGluaykge1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhsaW5rKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvYWQ6IGZ1bmN0aW9uKHVybCwgbWV0aG9kLCBjYWxsYmFjaykge1xuXG4gICAgICAgICAgICBsZXQgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICAvLyBTZXR1cCBvdXIgbGlzdGVuZXIgdG8gcHJvY2VzcyBjb21wbGV0ZWQgcmVxdWVzdHNcbiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gSW4gbG9jYWwgZmlsZXMsIHN0YXR1cyBpcyAwIHVwb24gc3VjY2VzcyBpbiBNb3ppbGxhIEZpcmVmb3hcbiAgICAgICAgICAgICAgICBpZih4aHIucmVhZHlTdGF0ZSA9PT0gWE1MSHR0cFJlcXVlc3QuRE9ORSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHhoci5zdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IDAgfHwgKHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgNDAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHJlcXVlc3QgaGFzIGJlZW4gY29tcGxldGVkIHN1Y2Nlc3NmdWxseVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlICsgXCIgaW4gXCIgKyB4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsKTtcbiAgICAgICAgICAgIHhoci5zZW5kKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNjcm9sbFRvOiBmdW5jdGlvbihzZWxlY3RvciwgZHVyYXRpb24pIHtcbiAgICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGxldCB0YXJnZXQgPSBzZWxlY3RvciA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpIDogbnVsbDtcbiAgICAgICAgICAgIGlmICh0YXJnZXQgIT09IG51bGwgJiYgKHR5cGVvZiB0YXJnZXQuZGF0YXNldC5zY3JvbGxpbmcgPT09IFwidW5kZWZpbmVkXCIgfHwgdGFyZ2V0LmRhdGFzZXQuc2Nyb2xsaW5nICE9PSBcIjFcIikpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQuZGF0YXNldC5zY3JvbGxpbmcgPSBcIjFcIjtcbiAgICAgICAgICAgICAgICAvLyBXYWl0IGZvciBzd2lwZXIgaW5pdGlhbGl6YXRpb25cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0WSA9ICQodGFyZ2V0KS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkKHRhcmdldCkuaGFzQ2xhc3MoJ3RhYi1wYW5lJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFkgPSAkKHRhcmdldCkucGFyZW50KCkucGFyZW50KCkub2Zmc2V0KCkudG9wIC0gMTA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0ICRvZmZzZXRQYXJlbnQgPSAkKCcjaGVhZGVyLXRvcCcpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgeU9mZnNldCA9ICRvZmZzZXRQYXJlbnQuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZHVyYXRpb24gPT09IFwidW5kZWZpbmVkXCIgfHwgIWR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDIwMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5zdG9wKCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc2Nyb2xsVG9wJzogdGFyZ2V0WSAtIHlPZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgfSwgZHVyYXRpb24sICdzd2luZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5kYXRhc2V0LnNjcm9sbGluZyA9IFwiMFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1RhcmdldFkgPSAkKHRhcmdldCkub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdG9yLmluZGV4T2YoJyMnKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gc2VsZWN0b3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcbiAgICB9O1xufSkpO1xuIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwibW9kdWxlIiwiZXhwb3J0cyIsImFwcENvbW1vbiIsImluaXQiLCJzZWxmIiwiaW5pdFRhYnMiLCJpbml0Q2xpY2tUb2dnbGUiLCJpbml0Q2xpY2tMb2FkIiwiaW5pdENvbnRlbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibGFzdFNjcm9sbEhhc2giLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhhc2giLCJzY3JvbGxUbyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInJlcGxhY2UiLCIkYWN0aXZlVGFiIiwiJCIsImxlbmd0aCIsInBhcmVudHMiLCJmaW5kIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsInBhcmVudCIsImhhc0NsYXNzIiwidGFiIiwib24iLCJlIiwidGFyZ2V0IiwicGFyZW50Tm9kZSIsInBvcG92ZXIiLCJpbml0U29ydGFibGVUYWJsZXMiLCJzb3J0YWJsZVRhYmxlTm9kZXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZ2V0Q2VsbFZhbHVlIiwidHIiLCJpZHgiLCJjaGlsZHJlbiIsImlubmVyVGV4dCIsInRleHRDb250ZW50IiwiY29tcGFyZXIiLCJhc2MiLCJhIiwiYiIsInYxIiwidjIiLCJpc05hTiIsInRvU3RyaW5nIiwibG9jYWxlQ29tcGFyZSIsInNvcnRCeUhlYWRlciIsInRhYmxlTm9kZSIsInRhYmxlQ29sTm9kZXMiLCJ0aCIsInRib2R5IiwidEJvZGllcyIsIm5ld1NvcnRBc2MiLCJmb3JFYWNoIiwicmVzZXRUaCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiYWRkIiwiQXJyYXkiLCJmcm9tIiwic29ydCIsImluZGV4T2YiLCJhcHBlbmRDaGlsZCIsImkiLCJuIiwic29ydGFibGVDb2x1bW5Db3VudCIsInNvcnRhYmxlVGgiLCJ0aEh0bWwiLCJpbm5lckhUTUwiLCJ0cmltIiwic29ydGFibGUiLCJxdWVyeVNlbGVjdG9yIiwiaW5kZXgiLCJsb2FkQ29udGVudCIsInNvdXJjZU5vZGUiLCJ0YXJnZXROb2RlIiwiZGF0YXNldCIsImxvYWQiLCJ1cmwiLCJkYXRhIiwiY29udGVudCIsImxvYWROb2RlcyIsIkludGVyc2VjdGlvbk9ic2VydmVyRW50cnkiLCJwcm90b3R5cGUiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiZW50cmllcyIsImVudHJ5IiwiaW50ZXJzZWN0aW9uUmF0aW8iLCJ1bm9ic2VydmUiLCJvYnNlcnZlIiwib25DbGljayIsImxpbmsiLCJ0b2dnbGVFbHQiLCJ0b2dnbGUiLCJzdHlsZSIsImRpc3BsYXkiLCJ0YXJnZXRzIiwicmVtb3ZlQXR0cmlidXRlIiwidG9nZ2xlcyIsInNlbGVjdG9yIiwiY2FsbGJhY2siLCJldnQiLCJtYXRjaGVzIiwiY2xvc2VzdCIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwibWV0aG9kIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwiRE9ORSIsInN0YXR1cyIsIkpTT04iLCJwYXJzZSIsInJlc3BvbnNlVGV4dCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJtZXNzYWdlIiwib3BlbiIsInNlbmQiLCJkdXJhdGlvbiIsInNjcm9sbGluZyIsInNldFRpbWVvdXQiLCJ0YXJnZXRZIiwib2Zmc2V0IiwidG9wIiwiJG9mZnNldFBhcmVudCIsInlPZmZzZXQiLCJoZWlnaHQiLCJzdG9wIiwiYW5pbWF0ZSIsIm5ld1RhcmdldFkiXSwic291cmNlUm9vdCI6IiJ9