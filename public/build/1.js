(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[1],{

/***/ "./assets/js/modules/advanced-select.js":
/*!**********************************************!*\
  !*** ./assets/js/modules/advanced-select.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

/**
 * This file is part of the KDN OZG package.
 *
 * @author    Gert Hammes <info@gerthammes.de>
 * @copyright 2020 Gert Hammes
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
(function (root, factory) {
  if (true) {
    !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
  } else {}
})(this, function () {
  "use strict";
  /**
   * Initialize custom select2 elements:
   * jQuery and Select2 are loaded globally by Sonata Admin and therefore are not required here!
   */

  return {
    setUpList: function setUpList(advancedSelectElements) {
      var self = this;

      for (var i = 0, n = advancedSelectElements.length; i < n; i++) {
        self.initSelect2(advancedSelectElements.item(i));
      }
    },
    initSelect2: function initSelect2(container) {
      var self = this; // @see vendor/sonata-project/admin-bundle/src/Resources/public/Admin.js

      var select = jQuery(container);
      var allowClearEnabled = false;
      var popover = select.data('popover');
      var maximumSelectionSize = null;
      var minimumResultsForSearch = 10;
      select.removeClass('form-control');

      if (select.find('option[value=""]').length || select.attr('data-sonata-select2-allow-clear') === 'true') {
        allowClearEnabled = true;
      } else if (select.attr('data-sonata-select2-allow-clear') === 'false') {
        allowClearEnabled = false;
      }

      if (select.attr('data-sonata-select2-maximumSelectionSize')) {
        maximumSelectionSize = select.attr('data-sonata-select2-maximumSelectionSize');
      }

      if (select.attr('data-sonata-select2-minimumResultsForSearch')) {
        minimumResultsForSearch = select.attr('data-sonata-select2-minimumResultsForSearch');
      }

      var selectOptions = {
        width: function width() {
          // Select2 v3 and v4 BC. If window.Select2 is defined, then the v3 is installed.
          // NEXT_MAJOR: Remove Select2 v3 support.
          return self.getSelect2Width(window.Select2 ? this.element : select);
        },
        dropdownAutoWidth: true,
        minimumResultsForSearch: minimumResultsForSearch,
        allowClear: allowClearEnabled,
        maximumSelectionSize: maximumSelectionSize
      };
      select.select2(selectOptions);

      if (undefined !== popover) {
        select.select2('container').popover(popover.options);
      }

      if (select.attr('data-reload-selector')) {
        select.on('change', function (e) {
          var $reloadSelect = $(select.attr('data-reload-selector')).first();
          self.updateSelectChoices($reloadSelect, e);
        });
      }
    },
    updateSelectChoices: function updateSelectChoices($element, event) {
      var self = this;
      var type, changedId;

      if (event.added) {
        type = 'added';
        changedId = event.added.id;
      } else {
        type = 'removed';
        changedId = event.removed.id;
      }

      var postData = {
        changeData: {
          entityId: $element.attr('data-entity-id'),
          groupValues: event.val,
          type: type,
          groupId: changedId
        }
      };
      var xhttp = new XMLHttpRequest();

      xhttp.onreadystatechange = function () {
        if (this.readyState === 4 && this.status === 200) {
          var result = JSON.parse(this.responseText);
          $element.select2('destroy');
          var oldSelected = $element.val();
          var origSelect = $element.get(0);

          for (var i = origSelect.options.length - 1; i >= 0; i--) {
            origSelect.options[i] = null;
          }

          for (var _i = 0, n = result.data.serviceList.length; _i < n; _i++) {
            var opt = document.createElement('option');
            var object = result.data.serviceList[_i];
            opt.value = object.id;
            opt.innerHTML = object.text;
            origSelect.appendChild(opt);
          }

          if (!oldSelected) {
            oldSelected = [];
          }

          var newSelected = [];

          if (result.data.removed && result.data.removed.length > 0) {
            for (var k = 0, kn = oldSelected.length; k < kn; k++) {
              var choiceId = parseInt(oldSelected[k]);
              var found = false;

              for (var r = 0, rn = result.data.removed.length; r < rn; r++) {
                if (choiceId === result.data.removed[r].id) {
                  found = true;
                  break;
                }
              }

              if (!found) {
                newSelected.push(choiceId);
              }
            }
          } else if (result.data.added && result.data.added.length > 0) {
            newSelected = oldSelected;

            for (var a = 0, an = result.data.added.length; a < an; a++) {
              var addedObject = result.data.added[a];

              if (oldSelected.indexOf(addedObject.id) < 0) {
                newSelected.push(addedObject.id);
              }
            }
          }

          $(origSelect).val(newSelected);
          $(origSelect).select2({
            width: function width() {
              // Select2 v3 and v4 BC. If window.Select2 is defined, then the v3 is installed.
              // NEXT_MAJOR: Remove Select2 v3 support.
              return self.getSelect2Width(window.Select2 ? this.element : select);
            },
            dropdownAutoWidth: true,
            minimumResultsForSearch: 10,
            allowClear: true,
            maximumSelectionSize: null
          });
        }
      };

      var url = $element.attr('data-url');

      if (!url) {
        url = $($element.data('select2').select).attr('data-url');
      }

      xhttp.open("POST", url, true);
      xhttp.setRequestHeader("Content-Type", "application/json");
      xhttp.send(JSON.stringify(postData));
    },

    /** Return the width for simple and sortable select2 element
     * @see vendor/sonata-project/admin-bundle/src/Resources/public/Admin.js  **/
    getSelect2Width: function getSelect2Width(element) {
      var ereg = /width:(auto|(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc)))/i; // this code is an adaptation of select2 code (initContainerWidth function)

      var style = element.attr('style'); //console.log("main style", style);

      if (style !== undefined) {
        var attrs = style.split(';');

        for (var i = 0, l = attrs.length; i < l; i = i + 1) {
          var matches = attrs[i].replace(/\s/g, '').match(ereg);
          if (matches !== null && matches.length >= 1) return matches[1];
        }
      }

      style = element.css('width');

      if (style.indexOf("%") > 0) {
        return style;
      }

      return '100%';
    },
    addLoader: function addLoader(container) {
      container.innerHTML = '<div class="chart-loader"><i class="fa fa-cog fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></div>';
    }
  };
});

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hc3NldHMvanMvbW9kdWxlcy9hZHZhbmNlZC1zZWxlY3QuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJzZXRVcExpc3QiLCJhZHZhbmNlZFNlbGVjdEVsZW1lbnRzIiwic2VsZiIsImkiLCJuIiwibGVuZ3RoIiwiaW5pdFNlbGVjdDIiLCJpdGVtIiwiY29udGFpbmVyIiwic2VsZWN0IiwialF1ZXJ5IiwiYWxsb3dDbGVhckVuYWJsZWQiLCJwb3BvdmVyIiwiZGF0YSIsIm1heGltdW1TZWxlY3Rpb25TaXplIiwibWluaW11bVJlc3VsdHNGb3JTZWFyY2giLCJyZW1vdmVDbGFzcyIsImZpbmQiLCJhdHRyIiwic2VsZWN0T3B0aW9ucyIsIndpZHRoIiwiZ2V0U2VsZWN0MldpZHRoIiwid2luZG93IiwiU2VsZWN0MiIsImVsZW1lbnQiLCJkcm9wZG93bkF1dG9XaWR0aCIsImFsbG93Q2xlYXIiLCJzZWxlY3QyIiwidW5kZWZpbmVkIiwib3B0aW9ucyIsIm9uIiwiZSIsIiRyZWxvYWRTZWxlY3QiLCIkIiwiZmlyc3QiLCJ1cGRhdGVTZWxlY3RDaG9pY2VzIiwiJGVsZW1lbnQiLCJldmVudCIsInR5cGUiLCJjaGFuZ2VkSWQiLCJhZGRlZCIsImlkIiwicmVtb3ZlZCIsInBvc3REYXRhIiwiY2hhbmdlRGF0YSIsImVudGl0eUlkIiwiZ3JvdXBWYWx1ZXMiLCJ2YWwiLCJncm91cElkIiwieGh0dHAiLCJYTUxIdHRwUmVxdWVzdCIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXMiLCJyZXN1bHQiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJvbGRTZWxlY3RlZCIsIm9yaWdTZWxlY3QiLCJnZXQiLCJzZXJ2aWNlTGlzdCIsIm9wdCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsIm9iamVjdCIsInZhbHVlIiwiaW5uZXJIVE1MIiwidGV4dCIsImFwcGVuZENoaWxkIiwibmV3U2VsZWN0ZWQiLCJrIiwia24iLCJjaG9pY2VJZCIsInBhcnNlSW50IiwiZm91bmQiLCJyIiwicm4iLCJwdXNoIiwiYSIsImFuIiwiYWRkZWRPYmplY3QiLCJpbmRleE9mIiwidXJsIiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwic3RyaW5naWZ5IiwiZXJlZyIsInN0eWxlIiwiYXR0cnMiLCJzcGxpdCIsImwiLCJtYXRjaGVzIiwicmVwbGFjZSIsIm1hdGNoIiwiY3NzIiwiYWRkTG9hZGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNDLFdBQVVBLElBQVYsRUFBZ0JDLE9BQWhCLEVBQXlCO0FBQ3RCLE1BQUksSUFBSixFQUFnRDtBQUM1Q0Msd0NBQU9ELE9BQUQ7QUFBQTtBQUFBO0FBQUE7QUFBQSxvR0FBTjtBQUNILEdBRkQsTUFFTyxFQVNOO0FBQ0osQ0FiQSxFQWFDLElBYkQsRUFhTyxZQUFZO0FBQ2hCO0FBQ0E7QUFDSjtBQUNBO0FBQ0E7O0FBQ0ksU0FBTztBQUNIRSxhQUFTLEVBQUUsbUJBQVVDLHNCQUFWLEVBQWtDO0FBQ3pDLFVBQUlDLElBQUksR0FBRyxJQUFYOztBQUNBLFdBQUssSUFBSUMsQ0FBQyxHQUFHLENBQVIsRUFBV0MsQ0FBQyxHQUFHSCxzQkFBc0IsQ0FBQ0ksTUFBM0MsRUFBbURGLENBQUMsR0FBR0MsQ0FBdkQsRUFBMERELENBQUMsRUFBM0QsRUFBK0Q7QUFDM0RELFlBQUksQ0FBQ0ksV0FBTCxDQUFpQkwsc0JBQXNCLENBQUNNLElBQXZCLENBQTRCSixDQUE1QixDQUFqQjtBQUNIO0FBQ0osS0FORTtBQVFIRyxlQUFXLEVBQUUscUJBQVNFLFNBQVQsRUFBb0I7QUFDN0IsVUFBSU4sSUFBSSxHQUFHLElBQVgsQ0FENkIsQ0FFN0I7O0FBQ0EsVUFBSU8sTUFBTSxHQUFvQkMsTUFBTSxDQUFDRixTQUFELENBQXBDO0FBQ0EsVUFBSUcsaUJBQWlCLEdBQVMsS0FBOUI7QUFD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MEtIUSxhQUFTLEVBQUUsbUJBQVN6RixTQUFULEVBQW9CO0FBQzNCQSxlQUFTLENBQUMyRCxTQUFWLEdBQXNCLHNIQUF0QjtBQUNIO0FBNUtFLEdBQVA7QUE4S0gsQ0FqTUEsQ0FBRCxDIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIHRoZSBLRE4gT1pHIHBhY2thZ2UuXG4gKlxuICogQGF1dGhvciAgICBHZXJ0IEhhbW1lcyA8aW5mb0BnZXJ0aGFtbWVzLmRlPlxuICogQGNvcHlyaWdodCAyMDIwIEdlcnQgSGFtbWVzXG4gKlxuICogRm9yIHRoZSBmdWxsIGNvcHlyaWdodCBhbmQgbGljZW5zZSBpbmZvcm1hdGlvbiwgcGxlYXNlIHZpZXcgdGhlIExJQ0VOU0VcbiAqIGZpbGUgdGhhdCB3YXMgZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHNvdXJjZSBjb2RlLlxuICovXG4oZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgIGRlZmluZShmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgIC8vIE5vZGUuIERvZXMgbm90IHdvcmsgd2l0aCBzdHJpY3QgQ29tbW9uSlMsIGJ1dFxuICAgICAgICAvLyBvbmx5IENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHRoYXQgc3VwcG9ydCBtb2R1bGUuZXhwb3J0cyxcbiAgICAgICAgLy8gbGlrZSBOb2RlLlxuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHMgKHJvb3QgaXMgd2luZG93KVxuICAgICAgICAvLyBub2luc3BlY3Rpb24gSlNVbmRlZmluZWRQcm9wZXJ0eUFzc2lnbm1lbnRcbiAgICAgICAgcm9vdC5hcHBBZHZhbmNlU2VsZWN0ID0gZmFjdG9yeSgpO1xuICAgIH1cbn0odGhpcywgZnVuY3Rpb24gKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgY3VzdG9tIHNlbGVjdDIgZWxlbWVudHM6XG4gICAgICogalF1ZXJ5IGFuZCBTZWxlY3QyIGFyZSBsb2FkZWQgZ2xvYmFsbHkgYnkgU29uYXRhIEFkbWluIGFuZCB0aGVyZWZvcmUgYXJlIG5vdCByZXF1aXJlZCBoZXJlIVxuICAgICAqL1xuICAgIHJldHVybiB7XG4gICAgICAgIHNldFVwTGlzdDogZnVuY3Rpb24gKGFkdmFuY2VkU2VsZWN0RWxlbWVudHMpIHtcbiAgICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gYWR2YW5jZWRTZWxlY3RFbGVtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBzZWxmLmluaXRTZWxlY3QyKGFkdmFuY2VkU2VsZWN0RWxlbWVudHMuaXRlbShpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdFNlbGVjdDI6IGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgLy8gQHNlZSB2ZW5kb3Ivc29uYXRhLXByb2plY3QvYWRtaW4tYnVuZGxlL3NyYy9SZXNvdXJjZXMvcHVibGljL0FkbWluLmpzXG4gICAgICAgICAgICBsZXQgc2VsZWN0ICAgICAgICAgICAgICAgICAgPSBqUXVlcnkoY29udGFpbmVyKTtcbiAgICAgICAgICAgIGxldCBhbGxvd0NsZWFyRW5hYmxlZCAgICAgICA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IHBvcG92ZXIgICAgICAgICAgICAgICAgID0gc2VsZWN0LmRhdGEoJ3BvcG92ZXInKTtcbiAgICAgICAgICAgIGxldCBtYXhpbXVtU2VsZWN0aW9uU2l6ZSAgICA9IG51bGw7XG4gICAgICAgICAgICBsZXQgbWluaW11bVJlc3VsdHNGb3JTZWFyY2ggPSAxMDtcblxuICAgICAgICAgICAgc2VsZWN0LnJlbW92ZUNsYXNzKCdmb3JtLWNvbnRyb2wnKTtcblxuICAgICAgICAgICAgaWYgKHNlbGVjdC5maW5kKCdvcHRpb25bdmFsdWU9XCJcIl0nKS5sZW5ndGggfHwgc2VsZWN0LmF0dHIoJ2RhdGEtc29uYXRhLXNlbGVjdDItYWxsb3ctY2xlYXInKT09PSd0cnVlJykge1xuICAgICAgICAgICAgICAgIGFsbG93Q2xlYXJFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0LmF0dHIoJ2RhdGEtc29uYXRhLXNlbGVjdDItYWxsb3ctY2xlYXInKT09PSdmYWxzZScpIHtcbiAgICAgICAgICAgICAgICBhbGxvd0NsZWFyRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2VsZWN0LmF0dHIoJ2RhdGEtc29uYXRhLXNlbGVjdDItbWF4aW11bVNlbGVjdGlvblNpemUnKSkge1xuICAgICAgICAgICAgICAgIG1heGltdW1TZWxlY3Rpb25TaXplID0gc2VsZWN0LmF0dHIoJ2RhdGEtc29uYXRhLXNlbGVjdDItbWF4aW11bVNlbGVjdGlvblNpemUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbGVjdC5hdHRyKCdkYXRhLXNvbmF0YS1zZWxlY3QyLW1pbmltdW1SZXN1bHRzRm9yU2VhcmNoJykpIHtcbiAgICAgICAgICAgICAgICBtaW5pbXVtUmVzdWx0c0ZvclNlYXJjaCA9IHNlbGVjdC5hdHRyKCdkYXRhLXNvbmF0YS1zZWxlY3QyLW1pbmltdW1SZXN1bHRzRm9yU2VhcmNoJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBzZWxlY3RPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIHdpZHRoOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAvLyBTZWxlY3QyIHYzIGFuZCB2NCBCQy4gSWYgd2luZG93LlNlbGVjdDIgaXMgZGVmaW5lZCwgdGhlbiB0aGUgdjMgaXMgaW5zdGFsbGVkLlxuICAgICAgICAgICAgICAgICAgICAvLyBORVhUX01BSk9SOiBSZW1vdmUgU2VsZWN0MiB2MyBzdXBwb3J0LlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRTZWxlY3QyV2lkdGgod2luZG93LlNlbGVjdDIgPyB0aGlzLmVsZW1lbnQgOiBzZWxlY3QpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHJvcGRvd25BdXRvV2lkdGg6IHRydWUsXG4gICAgICAgICAgICAgICAgbWluaW11bVJlc3VsdHNGb3JTZWFyY2g6IG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoLFxuICAgICAgICAgICAgICAgIGFsbG93Q2xlYXI6IGFsbG93Q2xlYXJFbmFibGVkLFxuICAgICAgICAgICAgICAgIG1heGltdW1TZWxlY3Rpb25TaXplOiBtYXhpbXVtU2VsZWN0aW9uU2l6ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNlbGVjdC5zZWxlY3QyKHNlbGVjdE9wdGlvbnMpO1xuXG4gICAgICAgICAgICBpZiAodW5kZWZpbmVkICE9PSBwb3BvdmVyKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0XG4gICAgICAgICAgICAgICAgICAgIC5zZWxlY3QyKCdjb250YWluZXInKVxuICAgICAgICAgICAgICAgICAgICAucG9wb3Zlcihwb3BvdmVyLm9wdGlvbnMpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlbGVjdC5hdHRyKCdkYXRhLXJlbG9hZC1zZWxlY3RvcicpKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCAkcmVsb2FkU2VsZWN0ID0gJChzZWxlY3QuYXR0cignZGF0YS1yZWxvYWQtc2VsZWN0b3InKSkuZmlyc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi51cGRhdGVTZWxlY3RDaG9pY2VzKCRyZWxvYWRTZWxlY3QsIGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVTZWxlY3RDaG9pY2VzOiBmdW5jdGlvbigkZWxlbWVudCwgZXZlbnQpIHtcbiAgICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIGxldCB0eXBlLCBjaGFuZ2VkSWQ7XG4gICAgICAgICAgICBpZiAoZXZlbnQuYWRkZWQpIHtcbiAgICAgICAgICAgICAgICB0eXBlID0gJ2FkZGVkJztcbiAgICAgICAgICAgICAgICBjaGFuZ2VkSWQgPSBldmVudC5hZGRlZC5pZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdyZW1vdmVkJztcbiAgICAgICAgICAgICAgICBjaGFuZ2VkSWQgPSBldmVudC5yZW1vdmVkLmlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcG9zdERhdGEgPSB7XG4gICAgICAgICAgICAgICAgY2hhbmdlRGF0YToge1xuICAgICAgICAgICAgICAgICAgICBlbnRpdHlJZDogJGVsZW1lbnQuYXR0cignZGF0YS1lbnRpdHktaWQnKSxcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBWYWx1ZXM6IGV2ZW50LnZhbCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBJZDogY2hhbmdlZElkLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBsZXQgeGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHhodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IDQgJiYgdGhpcy5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKHRoaXMucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQuc2VsZWN0MignZGVzdHJveScpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgb2xkU2VsZWN0ZWQgPSAkZWxlbWVudC52YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG9yaWdTZWxlY3QgPSAkZWxlbWVudC5nZXQoMCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBvcmlnU2VsZWN0Lm9wdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdTZWxlY3Qub3B0aW9uc1tpXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIG4gPSByZXN1bHQuZGF0YS5zZXJ2aWNlTGlzdC5sZW5ndGg7IGkgPCBuOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0ID0gcmVzdWx0LmRhdGEuc2VydmljZUxpc3RbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHQudmFsdWUgPSBvYmplY3QuaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHQuaW5uZXJIVE1MID0gb2JqZWN0LnRleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnU2VsZWN0LmFwcGVuZENoaWxkKG9wdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFvbGRTZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2xkU2VsZWN0ZWQgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgbmV3U2VsZWN0ZWQgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5kYXRhLnJlbW92ZWQgJiYgcmVzdWx0LmRhdGEucmVtb3ZlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBrID0gMCwga24gPSBvbGRTZWxlY3RlZC5sZW5ndGggOyBrIDwga247IGsrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjaG9pY2VJZCA9IHBhcnNlSW50KG9sZFNlbGVjdGVkW2tdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCByID0gMCwgcm4gPSByZXN1bHQuZGF0YS5yZW1vdmVkLmxlbmd0aDsgciA8IHJuOyByKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNob2ljZUlkID09PSByZXN1bHQuZGF0YS5yZW1vdmVkW3JdLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1NlbGVjdGVkLnB1c2goY2hvaWNlSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQuZGF0YS5hZGRlZCAmJiByZXN1bHQuZGF0YS5hZGRlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdTZWxlY3RlZCA9IG9sZFNlbGVjdGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYSA9IDAsIGFuID0gcmVzdWx0LmRhdGEuYWRkZWQubGVuZ3RoIDsgYSA8IGFuOyBhKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYWRkZWRPYmplY3QgPSByZXN1bHQuZGF0YS5hZGRlZFthXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkU2VsZWN0ZWQuaW5kZXhPZihhZGRlZE9iamVjdC5pZCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1NlbGVjdGVkLnB1c2goYWRkZWRPYmplY3QuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkKG9yaWdTZWxlY3QpLnZhbChuZXdTZWxlY3RlZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgJChvcmlnU2VsZWN0KS5zZWxlY3QyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlbGVjdDIgdjMgYW5kIHY0IEJDLiBJZiB3aW5kb3cuU2VsZWN0MiBpcyBkZWZpbmVkLCB0aGVuIHRoZSB2MyBpcyBpbnN0YWxsZWQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTkVYVF9NQUpPUjogUmVtb3ZlIFNlbGVjdDIgdjMgc3VwcG9ydC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRTZWxlY3QyV2lkdGgod2luZG93LlNlbGVjdDIgPyB0aGlzLmVsZW1lbnQgOiBzZWxlY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duQXV0b1dpZHRoOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWluaW11bVJlc3VsdHNGb3JTZWFyY2g6IDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dDbGVhcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heGltdW1TZWxlY3Rpb25TaXplOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCB1cmwgPSAkZWxlbWVudC5hdHRyKCdkYXRhLXVybCcpO1xuICAgICAgICAgICAgaWYgKCF1cmwpIHtcbiAgICAgICAgICAgICAgICB1cmwgPSAkKCRlbGVtZW50LmRhdGEoJ3NlbGVjdDInKS5zZWxlY3QpLmF0dHIoJ2RhdGEtdXJsJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB4aHR0cC5vcGVuKFwiUE9TVFwiLCB1cmwsIHRydWUpO1xuICAgICAgICAgICAgeGh0dHAuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgICAgICB4aHR0cC5zZW5kKEpTT04uc3RyaW5naWZ5KHBvc3REYXRhKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBSZXR1cm4gdGhlIHdpZHRoIGZvciBzaW1wbGUgYW5kIHNvcnRhYmxlIHNlbGVjdDIgZWxlbWVudFxuICAgICAgICAgKiBAc2VlIHZlbmRvci9zb25hdGEtcHJvamVjdC9hZG1pbi1idW5kbGUvc3JjL1Jlc291cmNlcy9wdWJsaWMvQWRtaW4uanMgICoqL1xuICAgICAgICBnZXRTZWxlY3QyV2lkdGg6IGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgICAgICAgICAgbGV0IGVyZWcgPSAvd2lkdGg6KGF1dG98KChbLStdPyhbMC05XSpcXC4pP1swLTldKykocHh8ZW18ZXh8JXxpbnxjbXxtbXxwdHxwYykpKS9pO1xuXG4gICAgICAgICAgICAvLyB0aGlzIGNvZGUgaXMgYW4gYWRhcHRhdGlvbiBvZiBzZWxlY3QyIGNvZGUgKGluaXRDb250YWluZXJXaWR0aCBmdW5jdGlvbilcbiAgICAgICAgICAgIGxldCBzdHlsZSA9IGVsZW1lbnQuYXR0cignc3R5bGUnKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJtYWluIHN0eWxlXCIsIHN0eWxlKTtcblxuICAgICAgICAgICAgaWYgKHN0eWxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBsZXQgYXR0cnMgPSBzdHlsZS5zcGxpdCgnOycpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhdHRycy5sZW5ndGg7IGkgPCBsOyBpID0gaSArIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1hdGNoZXMgPSBhdHRyc1tpXS5yZXBsYWNlKC9cXHMvZywgJycpLm1hdGNoKGVyZWcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlcyAhPT0gbnVsbCAmJiBtYXRjaGVzLmxlbmd0aCA+PSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXNbMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdHlsZSA9IGVsZW1lbnQuY3NzKCd3aWR0aCcpO1xuICAgICAgICAgICAgaWYgKHN0eWxlLmluZGV4T2YoXCIlXCIpID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdHlsZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgfSxcbiAgICAgICAgYWRkTG9hZGVyOiBmdW5jdGlvbihjb250YWluZXIpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cImNoYXJ0LWxvYWRlclwiPjxpIGNsYXNzPVwiZmEgZmEtY29nIGZhLXNwaW4gZmEtM3ggZmEtZndcIj48L2k+PHNwYW4gY2xhc3M9XCJzci1vbmx5XCI+TG9hZGluZy4uLjwvc3Bhbj48L2Rpdj4nO1xuICAgICAgICB9XG4gICAgfTtcbn0pKTtcbiJdLCJzb3VyY2VSb290IjoiIn0=